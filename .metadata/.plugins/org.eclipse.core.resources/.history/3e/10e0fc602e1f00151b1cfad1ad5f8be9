package be.uantwerpen.tacle.tasksetgenerator;

import java.io.*;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import javax.xml.parsers.*;

import org.w3c.dom.*;
import org.xml.sax.SAXException;

public class XMLParser {
	
	private String inputFilename;
	private Document doc;
	private ArrayList<Node> nodes;
	
	public XMLParser(String inputFilename) {
		this.inputFilename = inputFilename;
		try {
			doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(new File(inputFilename));
		} catch (SAXException | ParserConfigurationException e) {
			// TODO Auto-generated catch block
			//e.printStackTrace();
			System.err.println("Could not parse file");
		} catch (IOException e){
			System.err.println("File does not excist.");
		}
	}
	public XMLParser(File inputFile) {
		this.inputFilename = inputFile.getName();
		try {
			doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(inputFile);
		} catch (SAXException | ParserConfigurationException e) {
			System.err.println("Could not parse file");
			//e.printStackTrace();
		} catch (IOException e){
			System.err.println("File does not excist.");
		}
		
	}
	public boolean parseFile(){
		
		NodeList node = null;
		
		nodes = new ArrayList<Node>();
		
		doc.getDocumentElement().normalize();
		
		/*Node rootNode = doc.getDocumentElement();
		System.out.println(rootNode.getNodeName());
		NodeList listN = rootNode.getChildNodes();
		Node n = listN.item(2);
		System.out.println(n.getChildNodes().item(0).getNodeName());*/
		
		
		node = doc.getElementsByTagName("taskSetData");
		if(node.getLength()==0 || node.getLength() > 1)
			System.err.println("The input must contain one TaskSetData element.");
		nodes.add(node.item(0));
		
		node = doc.getElementsByTagName("targetHardware");
		if(node.getLength()==0 || node.getLength() > 1)
			System.err.println("The input must contain one targetHardware element.");
		nodes.add((Element) node.item(0));
		System.out.println(node.item(0).getNodeName());

		node = doc.getElementsByTagName("benchMarkParameters");
		if(node.getLength() > 1)
			System.err.println("The input should only contain one benchmarkParameters element.");
		System.out.println(node.item(0).getNodeName());
		nodes.add((Element) node.item(0));	
		return true;
	}
	
	public Map<String,String[]> getElement(String name)
	{
		System.out.println(nodes.size());
		for(Node e:nodes)
		{
			NodeList listn = null;
			
			if(e.getNodeName().equalsIgnoreCase(name))
			{
				listn = e.getChildNodes();
				for(int i=0;i<listn.getLength();i++)
					if(listn.item(i).getNodeName()!="#text")//temp solution
						System.out.println(listn.item(i).getNodeName());
			}
		}
		return null;
	}
	
	private Map<String, String[]> parseElement(Element e) {
		
		Map<String,String[]> parameters = new HashMap<String, String[]>();
		NodeList node = e.getElementsByTagName("*");
		
		for(int i = 0;i<node.getLength();i++)
		{
			Node node1 = node.item(0);
			
		}
		
		return null;
	}
	private String getTextValue(Element ele, String tagName) {
		String textVal = null;
		NodeList nl = ele.getElementsByTagName(tagName);
		if(nl != null && nl.getLength() > 0) {
			Element el = (Element)nl.item(0);
			textVal = el.getFirstChild().getNodeValue();
		}
		return textVal;
	}

	public static void main(String[] args) {

		XMLParser parser = new XMLParser(new File("user.xml"));
		parser.parseFile();
		parser.getElement("targetHardware");
	}
	
	public String getInputFilename() {
		return inputFilename;
	}
	public void setInputFilename(String inputFilename) {
		this.inputFilename = inputFilename;
	}
	public Document getDoc() {
		return doc;
	}
	public void setDoc(Document doc) {
		this.doc = doc;
	}

}
